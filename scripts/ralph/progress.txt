# Ralph Progress Log
Started: 2026-01-15
Feature: Astro Migration & OfficeRnD Flex 2 API Update
Parent Task: astro-migration-001

## Codebase Patterns
- **Astro Config**: Static output mode with Tailwind integration. Config at `astro.config.mjs`
- **TypeScript**: Using Astro's strict preset via `astro/tsconfigs/strict`. Path aliases configured with `@/*` -> `src/*`
- **Environment Variables**: Typed in `src/env.d.ts`, example values in `.env.example`
- **Tailwind**: Using v3.4 with `@astrojs/tailwind` integration. Custom fonts (Poppins, Crimson Pro) in extend block
- **Types**: All API and transformed data types in `src/lib/types.ts`. Use `Api*` prefix for raw API types, `Transformed*` for processed data
- **Privacy Field Inversion**: Flex 2 API uses `isVisible`/`showContactDetails`/`showSocialProfiles` (positive) but templates use `hide`/`hideContactDetails`/`hidePublicProfiles` (negative) - invert when transforming
- **API Client**: Use `getConfigFromEnv()` for config, then `fetchMembers(config)` and `fetchCompanies(config)` for data. Pagination handled automatically.

---

## 2026-01-15 - Initialize Astro project with TypeScript and Tailwind
Task ID: task-001
- Replaced Gridsome dependencies with Astro 5.x stack
- Configured TypeScript strict mode via Astro's recommended preset
- Set up @astrojs/tailwind integration
- Created typed environment variable definitions for OfficeRnD API
- Updated tailwind.config.js for Tailwind v3 with ESM syntax
- Created minimal index.astro page to verify build works
- **Files created:**
  - `astro.config.mjs` - Astro config with static output
  - `tsconfig.json` - TypeScript config extending Astro strict preset
  - `src/env.d.ts` - Environment variable type definitions
  - `src/pages/index.astro` - Minimal placeholder page
  - `.env.example` - Environment variable template
- **Files modified:**
  - `package.json` - Complete rewrite for Astro dependencies
  - `tailwind.config.js` - Updated to Tailwind v3 ESM format
  - `.gitignore` - Added Astro-specific entries

**Learnings for future iterations:**
- Legacy Gridsome files (.vue) in src/pages cause warnings but don't break Astro build
- Astro check reports hints for legacy JS files but these are non-blocking
- Node 20+ required for Astro 5.x

---

## 2026-01-15 - Create TypeScript interfaces for API and transformed data
Task ID: task-002
- Created comprehensive TypeScript interfaces for the OfficeRnD Flex 2 API
- Defined raw API interfaces: `ApiMember`, `ApiCompany`, `ApiPaginatedResponse<T>`
- Defined transformed data interfaces: `TransformedMember`, `TransformedCompany`
- Created utility types: `PortalPrivacy`, `SocialProfiles`, `ApiProperties`, `MemberStatus`, `CompanyStatus`
- Added collection entry types for future Astro content collections
- All interfaces use strict typing with no `any` types
- **Files created:**
  - `src/lib/types.ts` - All API and transformed data type definitions
  - `src/lib/AGENTS.md` - Guidelines for the lib directory

**Learnings for future iterations:**
- The Flex 2 API uses `socialProfiles` object instead of separate `twitterHandle`/`linkedin` fields, but legacy fields may still exist in responses
- Privacy fields in Flex 2 API use positive logic (`isVisible`, `showContactDetails`) while templates use negative logic (`hide`, `hideContactDetails`) - must invert when transforming
- The `properties` object is flexible with an index signature for custom fields, but `sdg` is a known array field
- Legacy `.vue` files trigger warnings about `@astrojs/vue` package but these are non-blocking since they will be migrated

---

## 2026-01-15 - Implement OfficeRnD Flex 2 API client
Task ID: task-003
- Implemented OAuth 2.0 client credentials flow with automatic token caching
- Created `fetchMembers()` function with automatic pagination via `$cursorNext`
- Created `fetchCompanies()` function with automatic pagination via `$cursorNext`
- Added `ApiError` custom error class with status code and endpoint info
- Added `getConfigFromEnv()` helper for reading environment variables
- Uses native `fetch` (no axios dependency)
- **Files created:**
  - `src/lib/api.ts` - OfficeRnD API client with authentication and data fetching
- **Files modified:**
  - `src/lib/AGENTS.md` - Added API client documentation and usage patterns

**Learnings for future iterations:**
- TypeScript has trouble inferring types in `do-while` loops with generics - use explicit type annotations inside loops
- Token caching is essential due to 5 req/min rate limit on token endpoint
- The Flex 2 API uses `$cursorNext` query parameter (with dollar sign) for pagination
- Response format is `{ results: T[], cursorNext?, cursorPrev?, rangeStart, rangeEnd }`
- Native `fetch` works well in Astro - no need for axios

---
